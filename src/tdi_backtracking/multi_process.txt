#!/bin/bash

# Run with bash multi_process.txt 2> /dev/null
# Kill prematurely by going into terminal and killing all python subprocesses

compute_seg() {
    python tdi_backtracking.py --anomaly_input_fn $anomaly_input_fn --simulation_input_fn $simulation_input_fn --tdi_input_fn $tdi_input_fn --pipe_input_fn $pipe_input_fn --min_anomaly_i $(($1 * $seg_len)) --max_anomaly_i $(((($1 + 1)) * $seg_len)) --process $1
}

anomaly_input_fn="default_anomaly_output"
simulation_input_fn="default_simulation_output"
tdi_input_fn="default_tdi_output"
pipe_input_fn="default_pipe_output"

#anomaly_input_fn="long500"
#simulation_input_fn="long500"
#tdi_input_fn="long500"
#pipe_input_fn="long500"

num_processes=10
num_anomalies=500
seg_len=$((num_anomalies/num_processes))

min_anomaly_i=0
max_anomaly_i=$seg_len

for ((i=0; i<$num_processes; i++))
do
    compute_seg $i &
done
